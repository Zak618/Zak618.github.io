<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оптимальная стратегия эксплуатации оборудования</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(90deg, #e3ffe7 0%, #d9e7ff 100%);
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        label, input, select {
            display: block;
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            grid-column: span 2;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #results {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        canvas {
            margin-top: 20px;
            width: 100%;
            height: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Оптимальная стратегия эксплуатации оборудования</h1>
        <form id="inputForm">
            <label for="t0">Возраст оборудования (t<sub>0</sub>):</label>
            <input type="number" id="t0" name="t0" value="3" required>
            
            <label for="P">Стоимость нового оборудования (P):</label>
            <input type="number" id="P" name="P" value="14" required>

            <label for="rValues">Прибыль r(t) (через запятую):</label>
            <input type="text" id="rValues" name="rValues" value="8,7,7,7,6,4,3" required>

            <label for="sValues">Остаточная стоимость s(t) (через запятую):</label>
            <input type="text" id="sValues" name="sValues" value="null,12,11,9,7,5,4" required>

            <label for="preset">Или выберите готовый вариант:</label>
            <select id="preset">
                <option value="">Выберите вариант</option>
                <option value="5">Вариант 5 (t0 = 2, P = 13)</option>
                <option value="6">Вариант 6 (t0 = 3, P = 14)</option>
            </select>

            <button type="submit">Рассчитать</button>
        </form>

        <div id="results"></div>
        <canvas id="resultGraph"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.getElementById('preset').addEventListener('change', function() {
            if (this.value === '5') {
                document.getElementById('t0').value = 2;
                document.getElementById('P').value = 13;
                document.getElementById('rValues').value = "12,12,9,6,5,4";
                document.getElementById('sValues').value = "null,12,11,9,8,8";
            } else if (this.value === '6') {
                document.getElementById('t0').value = 3;
                document.getElementById('P').value = 14;
                document.getElementById('rValues').value = "8,7,7,7,6,4,3";
                document.getElementById('sValues').value = "null,12,11,9,7,5,4";
            }
        });

        document.getElementById('inputForm').addEventListener('submit', function(event) {
            event.preventDefault();

            // Получаем значения
            const t0 = parseInt(document.getElementById('t0').value);
            const P = parseInt(document.getElementById('P').value);
            const rValues = document.getElementById('rValues').value.split(',').map(v => v === "null" ? null : parseInt(v));
            const sValues = document.getElementById('sValues').value.split(',').map(v => v === "null" ? null : parseInt(v));

            // Вычисляем стратегию
            const result = calculateOptimalStrategy(t0, P, rValues, sValues);

            // Выводим подробные расчеты и результаты
            displayDetailedResults(result);

            // Отрисовка графика
            drawGraph(result);
        });

        function calculateOptimalStrategy(t0, P, rValues, sValues) {
            let n = 4;  // число лет
            let F = Array(n + 1).fill(0).map(() => Array(7).fill(0));  // Таблица Беллмана
            let strategy = [];
            let details = [];
        
            // Обратный ход по Беллману
            for (let k = n; k >= 1; k--) {
                let stepDetails = [];
                for (let t = 1; t <= 6; t++) {
                    let keep = rValues[t] + (k < n ? F[k + 1][t + 1] : 0);  // Сохранение
                    let replace = (sValues[t] ? sValues[t] - P + rValues[0] : 0) + (k < n ? F[k + 1][1] : 0);  // Замена
        
                    F[k][t] = Math.max(keep, replace);  // Максимизация прибыли
                    stepDetails.push({ year: k, age: t, keep, replace, best: F[k][t], action: F[k][t] === keep ? 'С' : 'З' });
                }
                details.push(stepDetails);
        
                // Определяем действие (замена или сохранение)
                if (F[k][t0] === rValues[t0] + (k < n ? F[k + 1][t0 + 1] : 0)) {
                    strategy.push('С');
                } else {
                    strategy.push('З');
                }
            }
        
            let profit = F[1][t0];  // Максимальная прибыль на 1-м году, начиная с возраста t0
            return { profit, strategy: strategy.reverse(), details: details.reverse() };
        }
        

        function displayDetailedResults(result) {
            let output = `<h2>Максимальная прибыль: ${result.profit} у.е.</h2>`;
            output += `<p>Оптимальная стратегия: ${result.strategy.join(', ')}</p>`;

            output += `<h3>Подробные расчеты:</h3>`;
            result.details.forEach((step, index) => {
                output += `<h4>Год ${index + 1}:</h4>`;
                output += `<table><tr><th>Возраст</th><th>Прибыль при сохранении</th><th>Прибыль при замене</th><th>Лучший выбор</th><th>Действие</th></tr>`;
                step.forEach(detail => {
                    output += `<tr>
                                <td>${detail.age}</td>
                                <td>${detail.keep}</td>
                                <td>${detail.replace}</td>
                                <td>${detail.best}</td>
                                <td>${detail.action}</td>
                               </tr>`;
                });
                output += `</table>`;
            });

            document.getElementById('results').innerHTML = output;
        }

        function drawGraph(result) {
            const ctx = document.getElementById('resultGraph').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Год 1', 'Год 2', 'Год 3', 'Год 4'],
                    datasets: [{
                        label: 'Оптимальная стратегия (возраст оборудования)',
                        data: result.strategy.map(s => (s === 'С' ? 1 : 0)),  // Для графика
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Действие (Сохранить = 1, Заменить = 0)'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
